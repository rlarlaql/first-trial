<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>3êµëŒ€ 28ì¼ ì£¼ê¸° ìë™ ë°°ì •</title>
  <style>
    body { font-family: ui-sans-serif, system-ui; max-width: 820px; margin: 40px auto; }
    .row { margin: 12px 0; }
    button { padding: 10px 16px; font-size: 15px; }
    input[type="file"] { padding: 8px; }
    label { display:block; font-weight:600; margin-bottom:6px; }
  </style>
</head>
<body>
  <h2>ğŸ—“ï¸ 3êµëŒ€ 28ì¼ ì£¼ê¸° ìë™ ë°°ì •</h2>
  <div class="row">
    <label>ì…ë ¥ í…œí”Œë¦¿(.xlsx) ì—…ë¡œë“œ</label>
    <input id="file" type="file" accept=".xlsx" />
  </div>
  <div class="row">
    <label><input id="optA" type="checkbox" /> ì˜µì…˜ A) ê³µíœ´ì¼ ë“± ì¶©ëŒ ì‹œ <b>ì£¼ ë‚´ 1íšŒ ì£¼íœ´</b>ë¡œ ì´ë™ í—ˆìš©</label>
  </div>
  <div class="row">
    <button id="run">ğŸš€ ìë™ ë°°ì • ì‹¤í–‰</button>
  </div>
  <div id="msg"></div>
  <script>
    const byId = (x) => document.getElementById(x);
    byId('run').onclick = async () => {
      const f = byId('file').files[0];
      if (!f) { alert('ì—‘ì…€ í…œí”Œë¦¿ì„ ì„ íƒí•˜ì„¸ìš”.'); return; }
      const fd = new FormData();
      fd.append('file', f);
      fd.append('allow_weekly_rest_shift_within_week', byId('optA').checked ? 'true' : '');
      const btn = byId('run'); btn.disabled = true; btn.textContent = 'â³ ë°°ì • ì¤‘â€¦';
      byId('msg').textContent = '';
      try {
        const res = await fetch('/api/schedule', { method: 'POST', body: fd });
        if (!res.ok || !res.headers.get('Content-Type')?.includes('spreadsheetml')) {
          const t = await res.text();
          throw new Error(`ìƒì„± ì‹¤íŒ¨: ${t}`);
        }
        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'ë²ˆí‘œ_28ì¼ì£¼ê¸°.xlsx';
        a.click();
        URL.revokeObjectURL(url);
        byId('msg').textContent = 'âœ… ë‹¤ìš´ë¡œë“œê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.';
      } catch (e) {
        byId('msg').textContent = `âŒ ${e.message}`;
      } finally {
        btn.disabled = false; btn.textContent = 'ğŸš€ ìë™ ë°°ì • ì‹¤í–‰';
      }
    };
  </script>
</body>
</html>
